#!/bin/bash -e
#Copyright Blake Loring <blake_l@parsed.uk> 2015

#Necessary as npm doesnt want to copy .PHONY and bin/
if [ -e bin ]; then
	echo "no bin dir"
else
  mkdir bin
fi

#Have to install as postinstall is broken on 0.12.7 on Ubuntu
./scripts/install_babel

if [ ! -z ${Z3_WEB} ]; then
	echo "Em Build"
	./scripts/get_emscripten
	./scripts/build_z3
else
	echo "DllBuild"
	./scripts/build_z3_std
fi

./scripts/binds

if [ ! -z ${Z3_WEB} ]; then
	echo "Em Build Cp"
	cp ./bin/z3_bindings_em_es5.js ./bin/package.js
else
	echo "DllBuild Cp"
	cp ./bin/z3_bindings_ref_es5.js ./bin/package.js
fi

echo "Done Z3JS"

echo "Building Wrapper"
./scripts/build_wrapper

exit 0
